(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[6712],{67007:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>G});var n=r(72500),i=r.n(n),o=r(1469),a=r.n(o),u=r(84596),l=r.n(u),s=r(27361),c=r.n(s),f=r(63105),p=r.n(f),m=r(27418),d=r.n(m),y=r(5055),v=r.n(y),g=r(75875),b=r.n(g),h=r(37275),x=r(86267),S=r(49977),O=r.n(S);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){R(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==w(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===w(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var C={},T=function(e){var t=(a()(e)&&e||e.split(","))[0],r=i().parse(t,!0);return i().format(d()({},r,{search:null},{query:d()({service:"WMS",version:"1.3.0",request:"GetCapabilities"},r.query)}))},B=function(e){var t=e&&e.Title,r=e.LogoURL&&M(M({},c()(e,"LogoURL.$")||{}),{},{format:c()(e,"LogoURL.Format")}),n=c()(e,'OnlineResource.$["xlink:href"]');return{title:t,logo:r,imageUrl:c()(e,'LogoURL.OnlineResource.$["xlink:href"]'),link:n}},j=function e(t){return t.Layer?(a()(t.Layer)&&t.Layer||[t.Layer]).reduce((function(t,r){return t.concat(e(r)).concat(r.Layer&&r.Name?[r]:[])}),[]):t.Name&&[t]||[]},W=function(e){return e.Request&&e.Request.GetMap&&e.Request.GetMap.DCPType&&e.Request.GetMap.DCPType.HTTP&&e.Request.GetMap.DCPType.HTTP.Get&&e.Request.GetMap.DCPType.HTTP.Get.OnlineResource&&e.Request.GetMap.DCPType.HTTP.Get.OnlineResource.$||void 0},P=function(){var e,t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0,l=(n.WMS_Capabilities||n.WMT_MS_Capabilities||{}).Capability,s=(n.WMS_Capabilities||n.WMT_MS_Capabilities||{}).Service,c=W(l),f=l.Layer&&(null===(e=l.Layer.SRS||l.Layer.CRS)||void 0===e?void 0:e.map((function(e){return e.toUpperCase()})))||[],p=l.Layer&&l.Layer.Attribution&&B(l.Layer.Attribution),m=l.Request&&l.Request.GetMap&&l.Request.GetMap.Format||[],y=j(l),v=(a()(y)?y:[y]).filter((function(e){return!u||-1!==e.Name.toLowerCase().indexOf(u.toLowerCase())||e.Title&&-1!==e.Title.toLowerCase().indexOf(u.toLowerCase())||e.Abstract&&-1!==e.Abstract.toLowerCase().indexOf(u.toLowerCase())}));return{numberOfRecordsMatched:v.length,numberOfRecordsReturned:Math.min(o,v.length),nextRecord:i+Math.min(o,v.length)+1,service:s,layerOptions:{version:(null===(t=n.WMS_Capabilities||n.WMT_MS_Capabilities)||void 0===t||null===(r=t.$)||void 0===r?void 0:r.version)||"1.3.0"},records:v.filter((function(e,t){return t>=i-1&&t<i-1+o})).map((function(e){return d()({},e,{formats:m,onlineResource:c,SRS:f,credits:e.Attribution?B(e.Attribution):p})}))}},A=function(e,t,r,n){var i=C[e];return i&&(new Date).getTime()<i.timestamp+1e3*((0,h.u8)("cacheExpire")||60)?new Promise((function(e){e(P(i.data,t,r,n))})):b().get(T(e)).then((function(i){var o;return v().parseString(i.data,{explicitArray:!1},(function(e,t){o=t})),C[e]={timestamp:(new Date).getTime(),data:o},P(o,t,r,n)}))};const G={flatLayers:j,parseUrl:T,getDimensions:function(e){return l()(e.Dimension||e.dimension||[]).map((function(t,r){var n=e.Extent&&l()(e.Extent)[r]||e.extent&&l()(e.extent)[r];return{name:t.$.name,units:t.$.units,unitSymbol:t.$.unitSymbol,default:t.$.default||n&&n.$.default,values:t._&&t.split(",")||n&&n._&&n.split(",")}}))},getCapabilities:function(e,t){var n=i().parse(e,!0),o=i().format(d()({},n,{query:d()({service:"WMS",version:"1.1.1",request:"GetCapabilities"},n.query)}));return new Promise((function(e){Promise.all([r.e(9942),r.e(7260)]).then(function(){var n=r(67260).unmarshaller;e(b().get(T(o)).then((function(e){var r;if(t)return v().parseString(e.data,{explicitArray:!1},(function(e,t){r=t})),r;var i=n.unmarshalString(e.data);return i&&i.value})))}.bind(null,r)).catch(r.oe)}))},describeLayer:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i().parse(e,!0),a=i().format(d()({},o,{query:d()({service:"WMS",version:"1.1.1",layers:t,request:"DescribeLayer"},o.query,n.query||{})}));return new Promise((function(e){Promise.all([r.e(9942),r.e(7260)]).then(function(){var t=r(67260).unmarshaller;e(b().get(T(a)).then((function(e){var r=t.unmarshalString(e.data);return r&&r.value&&r.value.layerDescription&&r.value.layerDescription[0]})))}.bind(null,r)).catch(r.oe)}))},getRecords:A,describeLayers:function(e,t){var r=i().parse(e,!0),n=i().format(d()({},r,{query:d()({service:"WMS",version:"1.1.1",layers:t,request:"DescribeLayer"},r.query)}));return b().get(T(n)).then((function(e){var t;return v().parseString(e.data,{explicitArray:!1},(function(e,r){t=r&&r.WMS_DescribeLayerResponse&&r.WMS_DescribeLayerResponse.LayerDescription})),(t=Array.isArray(t)?t:[t]).map((function(e){return M(M({},e&&e.$||{}),{},{layerName:e&&e.$&&e.$.name,query:M({},e&&e.query&&e.query.$||{})})}))}))},textSearch:function(e,t,r,n){return A(e,t,r,n)},parseLayerCapabilities:function e(t,r,n){return l()(n||c()(t,"capability.layer.layer")).reduce((function(n,i){return n||(!i.name&&i.layer?e(t,r,l()(i.layer)):2===r.name.split(":").length&&i.name&&2===i.name.split(":").length?r.name===i.name&&i:i.name&&2===i.name.split(":").length?r.name===i.name.split(":")[1]&&i:2===r.name.split(":").length?r.name.split(":")[1]===i.name&&i:r.name===i.name&&i)}),null)},getBBox:function(e,t){for(var r=e,n=r.EX_GeographicBoundingBox||r.exGeographicBoundingBox||(0,x.getWMSBoundingBox)(r.BoundingBox)||r.LatLonBoundingBox&&r.LatLonBoundingBox.$||r.latLonBoundingBox;!n&&r.Layer&&r.Layer.length;)n=(r=r.Layer[0]).EX_GeographicBoundingBox||r.exGeographicBoundingBox||(0,x.getWMSBoundingBox)(r.BoundingBox)||r.LatLonBoundingBox&&r.LatLonBoundingBox.$||r.latLonBoundingBox;n||(n={westBoundLongitude:-180,southBoundLatitude:-90,eastBoundLongitude:180,northBoundLatitude:90});var i={extent:[n.westBoundLongitude||n.minx,n.southBoundLatitude||n.miny,n.eastBoundLongitude||n.maxx,n.northBoundLatitude||n.maxy],crs:"EPSG:4326"};return t?{crs:i.crs,bounds:{minx:i.extent[0],miny:i.extent[1],maxx:i.extent[2],maxy:i.extent[3]}}:i},reset:function(){Object.keys(C).forEach((function(e){delete C[e]}))},preprocess:function(e){var t=e.domainAliases;return e.domainAliases=p()(t),O().Observable.of(e)}}},76712:(e,t,r)=>{"use strict";r.d(t,{n0:()=>K,tW:()=>ee,FJ:()=>te,F8:()=>re,p8:()=>ie,ll:()=>oe,eL:()=>ae,AD:()=>ue,oR:()=>le,LZ:()=>se,eX:()=>ce,QQ:()=>fe,B8:()=>pe,T6:()=>me});var n=r(27418),i=r.n(n),o=r(91175),a=r.n(o),u=r(1469),l=r.n(u),s=r(47037),c=r.n(s),f=r(84596),p=r.n(f),m=r(13218),d=r.n(m),y=r(89734),v=r.n(y),g=r(44908),b=r.n(g),h=r(64721),x=r.n(h),S=r(27361),O=r.n(S),w=r(14293),L=r.n(w),M=r(41609),R=r.n(M),C=r(72500),T=r.n(C),B=r(86267),j=r(37275),W=r(24262),P=r(86638),A=r(7294),G=r(33044),I=r(67007),q=r(88798),D=r(52259);function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}var U=void 0;function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach((function(t){$(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==E(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===E(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k(e,t){if(e){if("string"==typeof e)return N(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?N(e,t):void 0}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var V=function(e){return e&&e.replace(/\/csw$/,"/")},Z=function(e){return d()(e)&&e._||e},H=function(e,t){return e.filter((function(r){return A.C2(t,r,e,t,null)}))},Q=function(e){var t=Array.isArray(e.references)?e.references:[e.references];return a()([].filter.call(t,(function(t){return"WWW:LINK-1.0-http--image-thumbnail"===t.scheme||"thumbnail"===t.scheme||"WWW:DOWNLOAD-1.0-http--download"===t.scheme&&-1!==(t.value||"").indexOf("".concat(e.identifier||"","-thumb"))||"WWW:DOWNLOAD-REST_MAP"===t.scheme&&-1!==(t.value||"").indexOf("".concat(e.identifier||"","-thumb"))})))},X=function(e){var t,r,n,i=new URLSearchParams(e.value),o=new URLSearchParams,a=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=k(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw o}}}}(i);try{for(a.s();!(t=a.n()).done;){var u=(r=t.value,n=2,function(e){if(Array.isArray(e))return e}(r)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,u=[],l=!0,s=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);l=!0);}catch(e){s=!0,i=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw i}}return u}}(r,n)||k(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=u[0],s=u[1];o.append(l.toLocaleLowerCase(),s)}}catch(e){a.e(e)}finally{a.f()}var c=o.get("layers"),f=o.get("version");return!!c&&_(_({},e),{},{protocol:"OGC:WMS",name:c,value:"".concat(e.value.match(/[^\?]+[\?]+/g),"SERIVCE=WMS").concat(f&&"&VERSION=".concat(f))})},z=function(e,t,r){var n,i,o,a=r.name;if(void 0===a){a=e.title?e.title.join(" "):(0,P.S$)(t,"catalog.notAvailable");var u=(n=r.protocol,r.value,null!=(o=null===(i=[{protocol:"https://registry.geodati.gov.it/metadata-codelist/ProtocolValue/www-download",displayValue:"Download"},{protocol:"http://www.opengis.net/def/serviceType/ogc/wms",displayValue:"WMS"},{protocol:"http://www.opengis.net/def/serviceType/ogc/wfs",displayValue:"WFS"}].filter((function(e){return e.protocol===n}))[0])||void 0===i?void 0:i.displayValue)?o:"Link");a="".concat(u?"".concat(a," - ").concat(u):a)}return'<li><a target="_blank" href="'.concat(r.value,'">').concat(a,"</a></li>")},J={csw:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e;return n&&n.records?n.records.map((function(e){var n,o,u,s=e.dc;if(s&&s.URI){var f=l()(s.URI)?s.URI:s.URI&&[s.URI]||[],m=a()([].filter.call(f,(function(e){return"thumbnail"===e.name})))||a()([].filter.call(f,(function(e){var t;return!e.name&&(null===(t=e.protocol)||void 0===t?void 0:t.indexOf("image/"))>-1})));n=m?m.value:null,o=a()(f.map((function(e){if(e.protocol){if(e.protocol.match(/^OGC:WMS-(.*)-http-get-map/g)||e.protocol.match(/^OGC:WMS/g))return e;if(e.protocol.match(/serviceType\/ogc\/wms/g))return X(e)}return!1})).filter((function(e){return e})))}if(!o&&s&&s.references&&s.references.length){var d=Array.isArray(s.references)?s.references:[s.references];if(o=a()([].filter.call(d,(function(e){return e.scheme&&(e.scheme.match(/^OGC:WMS-(.*)-http-get-map/g)||"OGC:WMS"===e.scheme)})))){var y=T().parse(o.value,!0),g=y.query&&y.query.layers||s.alternative;o=i()({},o,{name:g})}}if(!o&&s&&s.references&&s.references.length){var h=Array.isArray(s.references)?s.references:[s.references];if(u=a()([].filter.call(h,(function(e){return e.scheme&&"WWW:DOWNLOAD-REST_MAP"===e.scheme})))){var S=s.alternative;u=i()({},u,{name:S})}}if(!n&&s&&s.references){var O=Q(s);O&&(n=O.value)}var w=[];if(s&&s.references&&(Array.isArray(s.references)?s.references:[s.references]).filter((function(e){return e.scheme.indexOf("http-get-capabilities")>-1})).forEach((function(e){var r=0===e.value.indexOf("http")?e.value:(t&&t.catalogURL||"")+"/"+e.value;w.push({type:e.scheme,url:r})})),o&&o.name){0===o.value.indexOf("http")||i()({},o,{value:(t&&t.catalogURL||"")+"/"+o.value});var L={type:o.protocol||o.scheme,url:o.value,SRS:[],params:{name:o.name}};w.push(L)}if(u&&u.name){var M={type:"arcgis",url:u.value,SRS:[],params:{name:u.name}};w.push(M)}n&&(0===n.indexOf("http")||(n=(V(t&&t.url)||"")+n));var R={boundingBox:e.boundingBox&&e.boundingBox.extent&&p()(e.boundingBox.extent.join(","))};if(s&&(R=_(_({},R),v()(Object.keys(s)).reduce((function(e,t){return _(_({},e),{},$({},t,b()(p()(s[t]))))}),{}))),s&&s.URI&&p()(s.URI)&&p()(s.URI).length&&(R=_(_({},R),{},{uri:["<ul>"+p()(s.URI).map(z.bind(U,R,r)).join("")+"</ul>"]})),s&&s.subject&&p()(s.subject)&&p()(s.subject).length&&(R=_(_({},R),{},{subject:["<ul>"+p()(s.subject).map((function(e){return"<li>".concat(e,"</li>")})).join("")+"</ul>"]})),w&&p()(w).length?R=_(_({},R),{},{references:["<ul>"+p()(w).map((function(e){return'<li><a target="_blank" href="'.concat(e.url,'">').concat(e.params&&e.params.name||e.url,"</a></li>")})).join("")+"</ul>"]}):delete R.references,s&&s.temporal){var C=c()(s.temporal)?s.temporal.split("; "):[];if(C.length){var B=C.filter((function(e){return-1!==e.indexOf("scheme=")})).map((function(e){var t=e.indexOf("=");return e.substr(t+1,e.length-1)}));B=B.length?B[0]:"W3C-DTF";var j=C.filter((function(e){return-1!==e.indexOf("start=")||-1!==e.indexOf("end=")})).map((function(e){var t=e.indexOf("="),n=e.substr(0,t),i=e.substr(t+1,e.length-1),o=e.length-t-1<=10;return x()(["start","end"],n)&&"W3C-DTF"===B&&!o?(0,P.S$)(r,"catalog.".concat(n))+new Date(i).toLocaleString():x()(["start","end"],n)?(0,P.S$)(r,"catalog.".concat(n))+i:""}));R=_(_({},R),{},{temporal:["<ul>"+j.map((function(e){return"<li>".concat(e,"</li>")})).join("")+"</ul>"]})}}return{boundingBox:e.boundingBox,description:s&&c()(s.abstract)&&s.abstract||"",layerOptions:t&&t.layerOptions||{},identifier:s&&c()(s.identifier)&&s.identifier||"",references:w,thumbnail:n,title:s&&c()(s.title)&&s.title||"",tags:s&&s.tags||"",metadata:R,capabilities:e.capabilities}})):null},wms:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&e.records?e.records.map((function(r){return{capabilities:r,credits:r.credits,boundingBox:I.ZP.getBBox(r),description:r.Abstract||r.Title||r.Name,identifier:r.Name,service:e.service,tags:"",layerOptions:_(_({},(null==t?void 0:t.layerOptions)||{}),(null==e?void 0:e.layerOptions)||{}),title:(0,W.EM)(r)||r.Name,formats:p()(r.formats||[]),dimensions:(r.Dimension&&p()(r.Dimension)||[]).map((function(e){return i()({},{values:e._&&e._.split(",")||[]},e.$||{})})).filter((function(e){return e&&"time"!==e.name})),references:[{type:"OGC:WMS",url:t&&t.url,SRS:r.SRS&&(l()(r.SRS)?r.SRS:[r.SRS])||[],params:{name:r.Name}}]}})):null},wmts:function(e,t){return e&&e.records?e.records.map((function(e){var r=p()(A.f1(e)||t&&t.url);1===r.length&&(r=r[0]);var n=A.dN(e),o=p()(e.TileMatrixSetLink||[]).reduce((function(t,r){var n,o=a()((e.TileMatrixSet&&p()(e.TileMatrixSet)||[]).filter((function(e){return e["ows:Identifier"]===r.TileMatrixSet}))),u=o&&B.default.getEPSGCode(o["ows:SupportedCRS"]),l=r.TileMatrixSetLimits&&(r.TileMatrixSetLimits.TileMatrixLimits||[]).map((function(e){return{identifier:e.TileMatrix,ranges:{cols:{min:e.MinTileCol,max:e.MaxTileCol},rows:{min:e.MinTileRow,max:e.MaxTileRow}}}}))||o.TileMatrix.map((function(e){return{identifier:e["ows:Identifier"]}}));return i()(t,($(n={},o["ows:Identifier"],l),$(n,u,l),n))}),{}),u=function(e){var t=e["ows:WGS84BoundingBox"];return t||(t={"ows:LowerCorner":"-180.0 -90.0","ows:UpperCorner":"180.0 90.0"}),t}(e);return{title:Z(e["ows:Title"]||e["ows:Identifier"]),description:Z(e["ows:Abstract"]||e["ows:Title"]||e["ows:Identifier"]),identifier:Z(e["ows:Identifier"]),tags:"",layerOptions:t&&t.layerOptions||{},style:e.style,capabilitiesURL:n,queryable:e.queryable,requestEncoding:e.requestEncoding,tileMatrixSet:e.TileMatrixSet,matrixIds:o,format:e.format,TileMatrixSetLink:p()(e.TileMatrixSetLink),boundingBox:{extent:[u["ows:LowerCorner"].split(" ")[0],u["ows:LowerCorner"].split(" ")[1],u["ows:UpperCorner"].split(" ")[0],u["ows:UpperCorner"].split(" ")[1]],crs:"EPSG:4326"},references:[{type:"OGC:WMTS",url:r,SRS:H(e.SRS||[],o),params:{name:e["ows:Identifier"]}}]}})):null},tms:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&e.records?t.service&&"tms"===t.service.provider?e.records.map((function(e){return{title:e.title,tileMapUrl:e.href,description:"".concat(e.srs).concat(e.format?", "+e.format:""),tmsUrl:t.tmsUrl,references:[{type:"OGC:TMS",version:"1.0.0",url:t.url}]}})):e.records.map((function(e){return{title:e.title||e.provider,url:e.url,attribution:e.attribution,options:e.options,provider:e.provider,type:"tileprovider",references:[]}})):null},wfs:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).records;return e?e.map((function(e){return _(_({},e),{},{references:[{type:"OGC:WFS-1.1.0-http-get-capabilities",url:e.url},{type:"OGC:WFS-1.1.0-http-get-feature",url:e.url}]})})):null},backgrounds:function(e){return e&&e.records?e.records.map((function(e){return{description:e.title,title:e.title,identifier:e.name,thumbnail:e.thumbURL,references:[],background:e}})):null}},K=function(e){return e.filter((function(e){return B.default.isSRSAllowed(e)})).reduce((function(e,t){return i()(e,$({},t,!0))}),{})},Y=function(e,t){var r=e.split("?"),n={};return r.length>=2&&r[1]&&r[1].split(/[&;]/g).forEach((function(e){var r=e.split("=");-1===t.indexOf(r[0].toLowerCase())&&(n[r[0]]=r[1])})),{url:r[0],params:n}},ee=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).references,t=void 0===e?[]:e;return{wfs:a()(t.filter((function(e){return e.type&&("OGC:WFS"===e.type||e.type.indexOf("OGC:WFS")>-1&&e.type.indexOf("http-get-feature")>-1)}))),wms:a()(t.filter((function(e){return e.type&&("OGC:WMS"===e.type||e.type.indexOf("OGC:WMS")>-1&&e.type.indexOf("http-get-map")>-1)}))),wmts:a()(t.filter((function(e){return e.type&&("OGC:WMTS"===e.type||e.type.indexOf("OGC:WMTS")>-1&&e.type.indexOf("http-get-map")>-1)}))),tms:a()(t.filter((function(e){return e.type&&("OGC:TMS"===e.type||e.type.indexOf("OGC:TMS")>-1)})))}},te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{references:[]};return{esri:a()(e.references.filter((function(e){return e.type&&("ESRI:SERVER"===e.type||"arcgis"===e.type)})))}},re=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).references,t=void 0===e?[]:e,r=a()(t.filter((function(e){return e.type&&e.type.indexOf("OGC:WMS")>-1&&e.type.indexOf("http-get-capabilities")>-1}))),n=a()(t.filter((function(e){return e.type&&e.type.indexOf("OGC:WFS")>-1&&e.type.indexOf("http-get-capabilities")>-1}))),i=a()(t.filter((function(e){return e.type&&e.type.indexOf("OGC:WMTS")>-1&&e.type.indexOf("http-get-capabilities")>-1}))),o=[];return r&&o.push({type:"WMS_GET_CAPABILITIES",url:r.url,labelId:"catalog.wmsGetCapLink"}),i&&o.push({type:"WMTS_GET_CAPABILITIES",url:i.url,labelId:"catalog.wmtsGetCapLink"}),n&&o.push({type:"WFS_GET_CAPABILITIES",url:n.url,labelId:"catalog.wfsGetCapLink"}),o},ne=function(e){return e&&!l()(e)&&-1!==e.indexOf(",")?e.split(",").map((function(e){return e.trim()})):e},ie=function(e){var t,r;return"wms"===e.type?[e.url].concat((r=null!==(t=e.domainAliases)&&void 0!==t?t:[],function(e){if(Array.isArray(e))return N(e)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||k(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).join(","):e.url},oe=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"wms",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.removeParams,o=void 0===i?[]:i,a=n.format,u=n.catalogURL,s=n.url,c=n.formats,f=void 0===c?{}:c,p=n.map,m=void 0===p?{}:p,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},y=arguments.length>4?arguments[4]:void 0;if(!e||!e.references)return null;var v,g,b=ee(e),h=b.wms,x=b.wmts,S=h||x,O=function(e){return Y(j.ZP.cleanDuplicatedQuestionMarks(e),["request","layer","layers","service","version"].concat(o))},w=ne(S.url);if(w&&l()(w))v=w.map((function(e){return O(e)})).map((function(e){return e.url})),g=w.map((function(e){return O(e)})).map((function(e){return e.params})).reduce((function(e,t){return _(_({},e),t)}),{});else{var M=O(w||u);v=M.url,g=M.params}var C,T=(C=s||v,l()(C)&&1===C.length?C[0]:C),B=K(S.SRS),W=null!==(t=null==e?void 0:e.capabilities)&&void 0!==t?t:{},P=W.MaxScaleDenominator,A=W.MinScaleDenominator,G=_(_(_({type:r,requestEncoding:e.requestEncoding,style:e.style,format:a,url:T,capabilitiesURL:e.capabilitiesURL,queryable:e.queryable,visibility:!0,dimensions:e.dimensions||[],name:S.params&&S.params.name,title:e.title||S.params&&S.params.name,matrixIds:"wmts"===r?e.matrixIds||[]:void 0,description:e.description||"",tileMatrixSet:"wmts"===r?e.tileMatrixSet||[]:void 0,credits:!j.ZP.getConfigProp("noCreditsFromCatalog")&&e.credits,bbox:{crs:e.boundingBox.crs,bounds:{minx:e.boundingBox.extent[0],miny:e.boundingBox.extent[1],maxx:e.boundingBox.extent[2],maxy:e.boundingBox.extent[3]}},links:re(e),params:g,allowedSRS:B,catalogURL:u},d),e.layerOptions),{},{localizedLayerStyles:L()(y)?void 0:y});if("wms"===r&&(R()(f)||(G=_(_({},G),{},{imageFormats:f.imageFormats,infoFormats:f.infoFormats})),!R()(m)&&(P||A))){var I=(!L()(A)&&(0,D.getResolutionObject)(A,"scale",m)||{}).resolution,q=(!L()(P)&&(0,D.getResolutionObject)(P,"scale",m)||{}).resolution;G=_(_({},G),{},{minResolution:I,maxResolution:q})}return G},ae=function(e,t,r,n){return J[e]&&J[e](t,r,n)||null},ue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||!e.references)return null;var r=te(e).esri;return _({type:r.type,url:r.url,visibility:!0,dimensions:e.dimensions||[],name:r.params&&r.params.name,bbox:{crs:e.boundingBox.crs,bounds:{minx:e.boundingBox.extent[0],miny:e.boundingBox.extent[1],maxx:e.boundingBox.extent[2],maxy:e.boundingBox.extent[3]}}},t)},le=function(e,t,r){var n=e.tileMapUrl,i=t.TileMap,o=void 0===i?{}:i,a=r.forceDefaultTileGrid,u=o.Title,l=o.Abstract,s=o.SRS,c=o.BoundingBox,f=void 0===c?{}:c,m=o.Origin,d=o.TileFormat,y=void 0===d?{}:d,v=o.TileSets,g=o.$,b=g.version,h=g.tilemapservice,x=O()(f,"$",{}),S=x.minx,w=x.miny,L=x.maxx,M=x.maxy,R=O()(m,"$"),C=R.x,T=R.y,B=O()(y,"$",{}),j=B.width,W=B.height,P=B["mime-type"],A=B.extension,I=[parseFloat(j),parseFloat(W,10)],q=p()(O()(v,"TileSet",[]).map((function(e){return e.$}))).map((function(e){var t=e.href,r=e.order,n=e["units-per-pixel"];return{href:(0,G.cleanAuthParamsFromURL)(t),order:parseFloat(r),resolution:parseFloat(n)}})),D=O()(v,"profile");return{title:u,visibility:!0,hideErrors:!0,name:u,allowedSRS:$({},s,!0),description:l,srs:s,version:b,tileMapService:h?(0,G.cleanAuthParamsFromURL)(h):void 0,type:"tms",profile:D,tileMapUrl:n,forceDefaultTileGrid:a,bbox:f&&{crs:s,bounds:{minx:parseFloat(S),miny:parseFloat(w),maxx:parseFloat(L),maxy:parseFloat(M)}},tileSets:q,origin:{x:parseFloat(C),y:parseFloat(T)},format:P,tileSize:I,extension:A}},se=function(e){return _({type:e.type||"wfs",search:{url:e.url,type:"wfs"},url:e.url,queryable:e.queryable,visibility:!0,name:e.name,title:e.title||e.name,description:e.description||"",bbox:e.boundingBox,links:re(e),style:{weight:1,color:"rgba(0, 0, 255, 1)",opacity:1,fillColor:"rgba(0, 0, 255, 0.1)",fillOpacity:.1,radius:10}},e.layerOptions)},ce=function(e){return{type:"tileprovider",visibility:!0,url:e.url,title:e.title,attribution:e.attribution,options:e.options,provider:e.provider,name:e.provider}},fe=[{label:"image/png",value:"image/png"},{label:"image/png8",value:"image/png8"},{label:"image/jpeg",value:"image/jpeg"},{label:"image/vnd.jpeg-png",value:"image/vnd.jpeg-png"},{label:"image/vnd.jpeg-png8",value:"image/vnd.jpeg-png8"},{label:"image/gif",value:"image/gif"}],pe=function(){return b()(Object.values((0,q.eq)()))},me=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return I.ZP.getCapabilities(e).then((function(e){var r,n,i=O()(e,"capability.request.getMap.format",[]);if(R()(i))r=fe;else{var o=fe.map((function(e){return e.value}));r=(i=i.map((function(e){var t=e.value;return{label:t,value:t}}))).filter((function(e){var t=e.value;return x()(o,t)}))||[]}if(t){var a=O()(e,"capability.request.getFeatureInfo.format",[]),u=pe();R()(a)?n=u:(a=a.map((function(e){return e.value})),n=b()(a.filter((function(e){return x()(u,e)})))||[])}return t?{imageFormats:r,infoFormats:n}:r})).catch((function(){return t?{imageFormats:fe,infoFormats:pe()}:fe}))}}}]);