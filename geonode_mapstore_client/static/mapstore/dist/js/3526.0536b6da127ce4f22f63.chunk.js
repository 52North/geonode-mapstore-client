(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[3526],{39480:(t,e,r)=>{"use strict";r.d(e,{Z:()=>s});var n=r(190109),o=r(187982),i=r(63190),l=r(561733);class a extends n.ZP{constructor(t,e,r){super(),void 0!==r&&void 0===e?this.setFlatCoordinates(r,t):(e=e||0,this.setCenterAndRadius(t,e,r))}clone(){const t=new a(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,r,n){const o=this.flatCoordinates,i=t-o[0],l=e-o[1],a=i*i+l*l;if(a<n){if(0===a)for(let t=0;t<this.stride;++t)r[t]=o[t];else{const t=this.getRadius()/Math.sqrt(a);r[0]=o[0]+t*i,r[1]=o[1]+t*l;for(let t=2;t<this.stride;++t)r[t]=o[t]}return r.length=this.stride,a}return n}containsXY(t,e){const r=this.flatCoordinates,n=t-r[0],o=e-r[1];return n*n+o*o<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,r=e[this.stride]-e[0];return(0,o.T9)(e[0]-r,e[1]-r,e[0]+r,e[1]+r,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){const e=this.getExtent();if((0,o.kK)(t,e)){const e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||t[1]<=e[1]&&t[3]>=e[1]||(0,o.H6)(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,r=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+r;for(let r=1;r<e;++r)n[e+r]=t[r];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(t,e,r){this.setLayout(r,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let o=(0,i.IG)(n,0,t,this.stride);n[o++]=n[0]+e;for(let t=1,e=this.stride;t<e;++t)n[o++]=n[t];n.length=o,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const r=this.getCenter(),n=this.getStride();this.setCenter((0,l.U1)(r,0,r.length,n,t,e,r)),this.changed()}}a.prototype.transform;const s=a},230307:(t,e,r)=>{"use strict";r.d(e,{Pt:()=>s,u3:()=>u});var n=r(224899),o=r(183262),i=r(536777),l=r(415905),a=r(164547);function s(t,e){const r=t.canvas,l=(e=e||{}).pixelRatio||o.MP,a=e.size;a&&(r.width=a[0]*l,r.height=a[1]*l,r.style.width=a[0]+"px",r.style.height=a[1]+"px");const s=[0,0,r.width,r.height],u=(0,i.bA)((0,i.Ue)(),l,l);return new n.Z(t,l,s,u,0)}function u(t){if(!(t.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=t.inversePixelTransform[0],r=t.inversePixelTransform[1],o=Math.sqrt(e*e+r*r),s=t.frameState,u=(0,i.Jp)(t.inversePixelTransform.slice(),s.coordinateToPixelTransform),c=(0,l.se)(s.viewState.resolution,o);let y;const f=(0,a.Cs)();return f&&(y=(0,a.WO)(f,s.viewState.projection)),new n.Z(t.context,o,s.extent,u,s.viewState.rotation,c,y)}},185447:(t,e,r)=>{"use strict";r.d(e,{Z:()=>i});var n=r(798574);var o=r(427244);const i=function(t,e){if(e=e||{},!(0,o.Kn)(e))throw new Error("options is invalid");var r=e.properties;if(!t)throw new Error("geojson is required");var i=function(t){var e=[1/0,1/0,-1/0,-1/0];return(0,n.pZ)(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}(t),l=(i[0]+i[2])/2,a=(i[1]+i[3])/2;return(0,o.xm)([l,a],r)}},342196:(t,e,r)=>{"use strict";r.d(e,{v:()=>d});var n=r(673032),o=r(798574);function i(t,e){return void 0===e&&(e={}),(0,o.hE)(t,(function(t,r){var o=r.geometry.coordinates;return t+(0,n.Z)(o[0],o[1],e)}),0)}var l=r(257322),a=r(50076),s=r(427244),u=r(55608);function c(t,e,r){void 0===r&&(r={});for(var o=(0,u.wA)(t).coordinates,i=0,c=0;c<o.length&&!(e>=i&&c===o.length-1);c++){if(i>=e){var y=e-i;if(y){var f=(0,l.Z)(o[c],o[c-1])-180;return(0,a.Z)(o[c],y,f,r)}return(0,s.xm)(o[c])}i+=(0,n.Z)(o[c],o[c+1],r)}return(0,s.xm)(o[o.length-1])}var y=r(185447),f=r(688362);function g(t,e){if(t){if("string"==typeof t)return h(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var m=function(t){return["centerPoint","lineToArc","startPoint","endPoint"].includes(null==t?void 0:t.name)},d={cesium:function(t){var e=t.Cesium,r=function(t){if(null!=t&&t.positions)return{type:t.geometry.type,positions:null==t?void 0:t.positions[0]};var r=("Polygon"===t.geometry.type?t.geometry.coordinates[0]:t.geometry.coordinates).map((function(t){return e.Cartesian3.fromDegrees(t[0],t[1],t[2])}));return{type:t.geometry.type,positions:r}},n={centerPoint:function(t){var n,o=r(t),i=o.positions,l=o.type,a=i.map((function(t){var r=e.Cartographic.fromCartesian(t),n=r.longitude,o=r.latitude,i=r.height;return[e.Math.toDegrees(n),e.Math.toDegrees(o),i]}));if("LineString"===l){var s=i.reduce((function(t,r,n){return i[n+1]?t+e.Cartesian3.distance(r,i[n+1]):t}),0)/2,u=a.map((function(t,r){var n=i.filter((function(t,e){return e<r+1}));return[t[0],t[1],t[2],n.reduce((function(t,r,o){return n[o+1]?t+e.Cartesian3.distance(r,n[o+1]):t}),0)]})),c=u.find((function(t){return t[3]>s})),f=u.indexOf(c)-1,m=u[f],d=s-m[3],p=e.Cartographic.toCartesian(e.Cartographic.fromDegrees(m[0],m[1],m[2])),v=e.Cartesian3.normalize(e.Cartesian3.subtract(e.Cartographic.toCartesian(e.Cartographic.fromDegrees(c[0],c[1],c[2])),p,new e.Cartesian3),new e.Cartesian3);return{position:e.Cartesian3.add(p,e.Cartesian3.multiplyByScalar(v,d,new e.Cartesian3),new e.Cartesian3)}}var S,b=((0,y.Z)({type:"Polygon",coordinates:[[].concat((S=a,function(t){if(Array.isArray(t))return h(t)}(S)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(S)||g(S)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[a[0]])]})||{}).geometry,C=a.reduce((function(t,e){return t+function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,l,a=[],s=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(a.push(n.value),a.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{if(!s&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(u)throw o}}return a}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,3)[2]}),0)/a.length,O=[b.coordinates[0],b.coordinates[1],C]||0;return{position:e.Cartographic.toCartesian((n=e.Cartographic).fromDegrees.apply(n,O))}},lineToArc:function(){return{arcType:e.ArcType.GEODESIC,perPositionHeight:void 0}},startPoint:function(t){return{position:r(t).positions[0].clone()}},endPoint:function(t){var e=r(t).positions;return{position:e["Polygon"===t.geometry.type?e.length-2:e.length-1].clone()}}};return function(t){var e=t.msGeometry;return m(e)&&n[null==e?void 0:e.name]?n[e.name]:null}},openlayers:function(t){var e=t.Point,r=t.LineString,n=t.Polygon,o=t.GeoJSON,l=t.getCenter,a=new o,s={centerPoint:function(t){return function(r){var n=r.getGeometry().getType();if(["Point","MultiPoint"].includes(n))return r.getGeometry();var o=t?t.getView().getProjection().getCode():"EPSG:3857",s=r.getGeometry();if(["LineString"].includes(n)){var u=JSON.parse(a.writeFeature(r,{dataProjection:"EPSG:4326",featureProjection:o})),y=c(u,i(u)/2),g=(0,f.reproject)(y.geometry.coordinates,"EPSG:4326",o);return new e([g.x,g.y])}var h=s.getExtent(),m=l(h);return new e(m)}},lineToArc:function(t){return function(e){var o=t?t.getView().getProjection().getCode():"EPSG:3857",i=e.getGeometry().getType();if("LineString"===i||"MultiPoint"===i){var l=e.getGeometry().getCoordinates();return l=(0,f.transformLineToArcs)(l.map((function(t){var e=(0,f.reproject)(t,o,"EPSG:4326");return[e.x,e.y]}))),new r(l.map((function(t){var e=(0,f.reproject)(t,"EPSG:4326",o);return[e.x,e.y]})))}if("Polygon"===i){var a=e.getGeometry().getCoordinates()[0];return a=(0,f.transformLineToArcs)(a.map((function(t){var e=(0,f.reproject)(t,o,"EPSG:4326");return[e.x,e.y]}))),new n([a.map((function(t){var e=(0,f.reproject)(t,"EPSG:4326",o);return[e.x,e.y]}))])}return e.getGeometry()}},startPoint:function(){return function(t){var r=t.getGeometry(),n=r.getType();if(["Point","MultiPoint"].includes(n))return t.getGeometry();var o="Polygon"===n?r.getCoordinates()[0]:r.getCoordinates();return o.length>1?new e(o[0]):null}},endPoint:function(){return function(t){var r=t.getGeometry(),n=r.getType();if(["Point","MultiPoint"].includes(n))return t.getGeometry();var o="Polygon"===n?r.getCoordinates()[0]:r.getCoordinates();return new e(o.length>3?o[o.length-("Polygon"===n?2:1)]:o[o.length-1])}}};return function(t,e,r){var n,o=t.msGeometry;if(m(o)&&s[null==o?void 0:o.name])return{geometry:s[o.name](r)};var i=(null==e?void 0:e.getGeometry)&&(null==e||null===(n=e.getGeometry())||void 0===n?void 0:n.getType());return["Mark","Icon"].includes(t.kind)&&["LineString","MultiLineString","Polygon","MultiPolygon"].includes(i)?{geometry:s.centerPoint(r)}:null}},geojson:function(){var t={centerPoint:function(t){return["LineString"].includes(t.geometry.type)?c(t,i(t)/2).geometry.coordinates:(0,y.Z)(t).geometry.coordinates},lineToArc:function(t){return"LineString"===t.geometry.type?(0,f.transformLineToArcs)(t.geometry.coordinates):"Polygon"===t.geometry.type?t.geometry.coordinates.map(f.transformLineToArcs):null},startPoint:function(t){return"Polygon"===t.geometry.type?t.geometry.coordinates[0][0]:"LineString"===t.geometry.type?t.geometry.coordinates[0]:null},endPoint:function(t){return"Polygon"===t.geometry.type?t.geometry.coordinates[0][t.geometry.coordinates[0].length-2]:"LineString"===t.geometry.type?t.geometry.coordinates[t.geometry.coordinates.length-1]:null}};return function(e){var r=e.msGeometry;return m(r)&&t[null==r?void 0:r.name]?t[r.name]:null}}}},903526:(t,e,r)=>{"use strict";r.r(e),r.d(e,{createGetImagesSrc:()=>A,OlStyleParser:()=>E,default:()=>L});var n=r(656885),o=r(310699),i=r(287299),l=r(550793),a=r(862481),s=r(804672),u=r(260687),c=r(93785),y=r(324318),f=r(114694),g=r(352259),h=r(187982),m=r(888272),d=r(39480),p=r(230307),v=r(368784),S=r(156626),b=r(164547),C=r(830049),O=r(747037),P=r.n(O);function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function F(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function x(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?F(Object(r),!0).forEach((function(e){z(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,I(n.key),n)}}function z(t,e,r){return(e=I(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function I(t){var e=function(t,e){if("object"!=w(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==w(e)?e:e+""}var j=r(342196).v.openlayers({Point:o.Z,LineString:m.Z,Polygon:S.ZP,GeoJSON:v.Z,getCenter:h.qg}),A=function(){var t={};return function(e,r){return r?(t[r]||(t[r]=e.toDataURL()),t[r]):e.toDataURL()}},G=function(t){switch(t){case"top-left":return[0,0];case"top":return[.5,0];case"top-right":return[1,0];case"left":return[0,.5];case"center":default:return[.5,.5];case"right":return[1,.5];case"bottom-left":return[0,1];case"bottom":return[.5,1];case"bottom-right":return[1,1]}},T=function(t,e){var r=t,n=e;if((0,C.R9)(r)&&(r=C.st.evaluateStringFunction(r)),"string"!=typeof r)return null;if(r.startsWith("rgba("))return r;if(!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(r))return null;var o=parseInt(r.slice(1,3),16),i=parseInt(r.slice(3,5),16),l=parseInt(r.slice(5,7),16);return(0,C.H2)(n)&&(n=C.st.evaluateNumberFunction(n)),n<0&&(n=1),"rgba("+o+", "+i+", "+l+", "+n+")"},E=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),z(this,"unsupportedProperties",{Symbolizer:{MarkSymbolizer:{avoidEdges:"none",blur:"none",offsetAnchor:"none",pitchAlignment:"none",pitchScale:"none",visibility:"none"},FillSymbolizer:{antialias:"none",fillOpacity:{support:"none",info:"Use opacity instead."},visibility:"none"},IconSymbolizer:{allowOverlap:"none",anchor:"none",avoidEdges:"none",color:"none",haloBlur:"none",haloColor:"none",haloWidth:"none",keepUpright:"none",offsetAnchor:"none",size:{support:"partial",info:"Will set/get the width of the ol Icon."},optional:"none",padding:"none",pitchAlignment:"none",rotationAlignment:"none",textFit:"none",textFitPadding:"none",visibility:"none"},LineSymbolizer:{blur:"none",gapWidth:"none",gradient:"none",miterLimit:"none",roundLimit:"none",spacing:"none",visibility:"none",graphicFill:"none",graphicStroke:"none",perpendicularOffset:"none"},RasterSymbolizer:"none"},Function:{double2bool:{support:"none",info:"Always returns false"},atan2:{support:"none",info:"Currently returns the first argument"},rint:{support:"none",info:"Currently returns the first argument"},numberFormat:{support:"none",info:"Currently returns the first argument"},strAbbreviate:{support:"none",info:"Currently returns the first argument"}}}),z(this,"title","OpenLayers Style Parser"),z(this,"olIconStyleCache",{}),z(this,"OlStyleConstructor",i.ZP),z(this,"OlStyleImageConstructor",l.Z),z(this,"OlStyleFillConstructor",c.Z),z(this,"OlStyleStrokeConstructor",a.Z),z(this,"OlStyleTextConstructor",s.Z),z(this,"OlStyleCircleConstructor",u.Z),z(this,"OlStyleIconConstructor",y.Z),z(this,"OlStyleRegularshapeConstructor",f.Z),z(this,"isOlParserStyleFct",(function(t){return"function"==typeof t})),e&&(this.OlStyleConstructor=e.style.Style,this.OlStyleImageConstructor=e.style.Image,this.OlStyleFillConstructor=e.style.Fill,this.OlStyleStrokeConstructor=e.style.Stroke,this.OlStyleTextConstructor=e.style.Text,this.OlStyleCircleConstructor=e.style.Circle,this.OlStyleIconConstructor=e.style.Icon,this.OlStyleRegularshapeConstructor=e.style.RegularShape)},e=[{key:"readStyle",value:function(){return new Promise((function(t,e){try{t(null)}catch(t){e(t)}}))}},{key:"writeStyle",value:function(t){var e=this;return new Promise((function(r){var n=e.checkForUnsupportedProperties(t);try{r(e.getOlStyleTypeFromGeoStylerStyle(t),{unsupportedProperties:n,warnings:n&&["Your style contains unsupportedProperties!"]})}catch(t){r({errors:[t]})}}))}},{key:"checkForUnsupportedProperties",value:function(t){var e,r=this,n={};return null==t||null===(e=t.rules)||void 0===e||e.forEach((function(t){t.symbolizers.forEach((function(t){var e,o,i,l=(i="".concat(t.kind,"Symbolizer"))[0].toUpperCase()+i.slice(1),a=null===(e=r.unsupportedProperties)||void 0===e||null===(o=e.Symbolizer)||void 0===o?void 0:o[l];a&&("string"==typeof a||a instanceof String?(n.Symbolizer||(n.Symbolizer={}),n.Symbolizer[l]=a):Object.keys(t).forEach((function(t){a[t]&&(n.Symbolizer||(n.Symbolizer={}),n.Symbolizer[l]||(n.Symbolizer[l]={}),n.Symbolizer[l][t]=a[t])})))}))})),Object.keys(n).length>0?n:null}},{key:"getOlStyleTypeFromGeoStylerStyle",value:function(t){return this.geoStylerStyleToOlParserStyleFct(t)}},{key:"geoStylerStyleToOlParserStyleFct",value:function(t){var e=this,r=t.rules,n=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n.map,i=n.features;return(0,C.vg)(t,{features:i}).then((function(t){return e._getImages=function(){return t},e._getImageSrc=A(),e._computeIconScaleBasedOnSymbolizer=function(e,r){var n=t.find((function(t){return t.id===(0,C.kD)(e,r)}))||{},o=n.image,i=n.width,l=n.height;if(o&&i&&l){var a=i>l?i:l;return e.size/a}return e.size},function(t,n){e._getMap=function(){return o};var i=[],l=o?o.getView().getProjection().getUnits():"m",a=g.W[l],s=n*a*39.37*(25.4/.28);return r.forEach((function(r){var o,l,a=null==r||null===(o=r.scaleDenominator)||void 0===o?void 0:o.min,u=null==r||null===(l=r.scaleDenominator)||void 0===l?void 0:l.max,c=!0;(a||u)&&(a=(0,C._P)(a)?C.st.evaluateNumberFunction(a):a,u=(0,C._P)(u)?C.st.evaluateNumberFunction(u):u,a&&s<a&&(c=!1),u&&s>=u&&(c=!1));var y=!1;if(r.filter)try{y=(0,C.NG)(t,r.filter)}catch(t){y=!1}else y=!0;c&&y&&r.symbolizers.forEach((function(r){var o=e.getOlSymbolizerFromSymbolizer(r,t);if("function"!=typeof o)i.push(o);else{var l=o(t,n);i.push(l)}}))})),i}}))};return n.__geoStylerStyle=t,n}},{key:"getOlSymbolizerFromSymbolizer",value:function(t,e){var r;switch(t.kind){case"Mark":r=this.getOlPointSymbolizerFromMarkSymbolizer(t,e);break;case"Icon":r=this.getOlIconSymbolizerFromIconSymbolizer(t,e);break;case"Text":r=this.getOlTextSymbolizerFromTextSymbolizer(t,e);break;case"Line":r=this.getOlLineSymbolizerFromLineSymbolizer(t,e);break;case"Fill":r=this.getOlPolygonSymbolizerFromFillSymbolizer(t,e);break;case"Circle":r=this.getOlCircleSymbolizerFromCircleSymbolizer(t,e);break;default:var n=new this.OlStyleFillConstructor({color:"rgba(255,255,255,0.4)"}),o=new this.OlStyleStrokeConstructor({color:"#3399CC",width:1.25});r=new this.OlStyleConstructor({image:new this.OlStyleCircleConstructor({fill:n,stroke:o,radius:5}),fill:n,stroke:o})}return r}},{key:"getOlPointSymbolizerFromMarkSymbolizer",value:function(t,e){for(var r=x({},t),n=0,o=Object.keys(r);n<o.length;n++){var i=o[n];(0,C._P)(r[i])&&(r[i]=C.st.evaluateFunction(r[i],e))}var l=j(r,e,this._getMap()),a=this._getImages(),s=(0,C.kD)(r,t),u=a.find((function(t){return t.id===s}))||{},c=u.image,y=u.width,f=u.height;if(c){var g,h,m=y>f?y:f,d=2*r.radius/m,p=null!==(g=null===(h=this._getImageSrc)||void 0===h?void 0:h.call(this,c,s))&&void 0!==g?g:c.toDataURL();return new this.OlStyleConstructor(x({image:new this.OlStyleIconConstructor({src:p,crossOrigin:"anonymous",opacity:1,scale:d,rotation:"number"==typeof r.rotate?r.rotate*Math.PI/180:void 0})},l))}return new this.OlStyleConstructor}},{key:"getOlIconSymbolizerFromIconSymbolizer",value:function(t,e){for(var r=this,n=x({},t),o=0,i=Object.keys(n);o<i.length;o++){var l=i[o];(0,C._P)(n[l])&&(n[l]=C.st.evaluateFunction(n[l],e))}var a=j(n,e,this._getMap()),s={src:n.image,crossOrigin:"anonymous",opacity:n.opacity,scale:this._computeIconScaleBasedOnSymbolizer(n,t),rotation:"number"==typeof n.rotate?n.rotate*Math.PI/180:void 0,displacement:n.offset,anchor:G(n.anchor)},u=new RegExp("\\{\\{.*?\\}\\}","g");return"string"==typeof n.image&&n.image.match(u)?function(t){var e,o=(0,C.xV)(t,n.image,"");return o||(o=n.image+""),r.olIconStyleCache[o]?(e=r.olIconStyleCache[o],void 0!==s.rotation&&e.setRotation(s.rotation),void 0!==s.opacity&&e.setOpacity(s.opacity)):(e=new r.OlStyleIconConstructor(x(x({},s),{},{src:o})),r.olIconStyleCache[o]=e),new r.OlStyleConstructor(x({image:e},a))}:new this.OlStyleConstructor(x({image:new this.OlStyleIconConstructor(x({},s))},a))}},{key:"getOlLineSymbolizerFromLineSymbolizer",value:function(t,e){for(var r=x({},t),n=0,o=Object.keys(r);n<o.length;n++){var i=o[n];(0,C._P)(r[i])&&(r[i]=C.st.evaluateFunction(r[i],e))}var l=r.color,a=r.opacity,s=l&&null!=a?T(l,a):l,u=j(r,e,this._getMap());return new this.OlStyleConstructor(x(x({},u),{},{stroke:new this.OlStyleStrokeConstructor({color:s,width:r.width,lineCap:r.cap,lineJoin:r.join,lineDash:r.dasharray,lineDashOffset:r.dashOffset})}))}},{key:"getOlPolygonSymbolizerFromFillSymbolizer",value:function(t,e){for(var r,n=x({},t),o=0,i=Object.keys(n);o<i.length;o++){var l=i[o];(0,C._P)(n[l])&&(n[l]=C.st.evaluateFunction(n[l],e))}var a=j(n,e,this._getMap()),s=n.color,u=null!==(r=n.fillOpacity)&&void 0!==r?r:n.opacity,c=s&&Number.isFinite(u)?T(s,u):s,y=s?new this.OlStyleFillConstructor({color:c}):void 0,f=n.outlineColor,g=n.outlineOpacity,h=f&&Number.isFinite(g)?T(f,g):f,m=f||n.outlineWidth?new this.OlStyleStrokeConstructor({color:h,width:n.outlineWidth,lineDash:n.outlineDasharray}):void 0,d=new this.OlStyleConstructor(x(x({},a),{},{fill:y,stroke:m}));if(n.graphicFill){var p=this.getOlPatternFromGraphicFill(n.graphicFill);y||(y=new this.OlStyleFillConstructor({})),p&&y.setColor(p),d.setFill(y)}return d}},{key:"getOlCircleSymbolizerFromCircleSymbolizer",value:function(t,e){for(var r=this,n=x({},t),o=0,i=Object.keys(n);o<i.length;o++){var l=i[o];(0,C._P)(n[l])&&(n[l]=C.st.evaluateFunction(n[l],e))}var a=n.color,s=n.opacity,u=a&&Number.isFinite(s)?T(a,s):a,c=a?new this.OlStyleFillConstructor({color:u}):void 0,y=n.outlineColor,f=n.outlineOpacity,h=y&&Number.isFinite(f)?T(y,f):y,m=y||n.outlineWidth?new this.OlStyleStrokeConstructor({color:h,width:n.outlineWidth,lineDash:n.outlineDasharray}):void 0,p=new this.OlStyleConstructor({fill:c,stroke:m,geometry:function(t){var e=r._getMap();if(n.geodesic){var o=e.getView().getProjection().getCode(),i=(0,b.vs)(t.getGeometry().getCoordinates(),o,"EPSG:4326"),l=(0,S.iu)(i,n.radius,128);return l.transform("EPSG:4326",o),new S.ZP(l.getCoordinates())}return new d.Z(t.getGeometry().getCoordinates(),n.radius/g.W[e.getView().getProjection().getUnits()])}});if(n.graphicFill){var v=this.getOlPatternFromGraphicFill(n.graphicFill);c||(c=new this.OlStyleFillConstructor({})),v&&c.setColor(v),p.setFill(c)}return p}},{key:"getOlPatternFromGraphicFill",value:function(t){var e;if("Icon"===(null==t?void 0:t.kind)){var r,i=null===(r=e=this.getOlIconSymbolizerFromIconSymbolizer(t))||void 0===r?void 0:r.getImage();if(null==i||i.load(),(null==i?void 0:i.getImageState())!==n.Z.LOADED)return null}else{if("Mark"!==(null==t?void 0:t.kind)||!P()(null==t?void 0:t.wellKnownName))return null;e=this.getOlPointSymbolizerFromMarkSymbolizer(t)}var l=e.clone(),a=l.getImage(),s=document.createElement("canvas"),u=s.getContext("2d"),c=a.getScale()||1;a.setScale(1);var y=a.getSize(),f=(0,p.Pt)(u,{pixelRatio:c,size:y});f.setStyle(l);var g=y.map((function(t){return t/2}));return f.drawGeometry(new o.Z(g)),u.createPattern(s,"repeat")}},{key:"getOlTextSymbolizerFromTextSymbolizer",value:function(t,e){for(var r,n,o=this,i=x({},t),l=0,a=Object.keys(i);l<a.length;l++){var s=a[l];(0,C._P)(i[s])&&(i[s]=C.st.evaluateFunction(i[s],e))}var u,c=j(i,e,this._getMap()),y=i.color,f=i.opacity,g=y&&Number.isFinite(f)?T(y,f):y,h=i.haloColor,m=i.haloWidth,d=h&&Number.isFinite(f)?T(h,f):h,p=null!==(r=i.fontWeight)&&void 0!==r?r:"normal",v=null!==(n=i.fontStyle)&&void 0!==n?n:"normal",S=i.size,b=i.font,O=x({font:p+" "+v+" "+S+"px "+(null==b?void 0:b.join(", ")),fill:new this.OlStyleFillConstructor({color:g}),stroke:new this.OlStyleStrokeConstructor({color:d,width:m||0}),overflow:i.allowOverlap,offsetX:i.offset?i.offset[0]:0,offsetY:i.offset?i.offset[1]:0,rotation:"number"==typeof i.rotate?i.rotate*Math.PI/180:void 0},function(t){switch(t){case"top-left":return{textBaseline:"top",textAlign:"left"};case"top":default:return{textBaseline:"top",textAlign:"center"};case"top-right":return{textBaseline:"top",textAlign:"right"};case"left":return{textBaseline:"middle",textAlign:"left"};case"center":return{textBaseline:"middle",textAlign:"center"};case"right":return{textBaseline:"middle",textAlign:"right"};case"bottom-left":return{textBaseline:"bottom",textAlign:"left"};case"bottom":return{textBaseline:"bottom",textAlign:"center"};case"bottom-right":return{textBaseline:"bottom",textAlign:"right"}}}(i.anchor)),P=new RegExp("\\{\\{.*?\\}\\}","g");return(0,C.R9)(i.label)||(u=i.label?i.label.match(P):null),u?function(t){var e=new o.OlStyleTextConstructor(x({text:(0,C.xV)(t,i.label,"")},O));return new o.OlStyleConstructor(x(x({},c),{},{text:e}))}:new this.OlStyleConstructor(x(x({},c),{},{text:new this.OlStyleTextConstructor(x({text:i.label},O))}))}}],e&&k(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();z(E,"title","OpenLayers Style Parser");const L=E}}]);